<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>การติดตามยอดขายรถมือสอง 2569</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- PapaParse for CSV -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <!-- Google Fonts: Sarabun -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <meta name="robots" content="noindex, nofollow">

    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f3f4f6;
        }
        
        /* Card width fixed, height auto */
        .card-width {
            width: 375px;
            min-width: 375px;
        }
        .text-big {
            font-size: 2.5rem;
            line-height: 1;
            font-weight: 700;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex flex-col min-w-fit">

    <!-- Header & Filter -->
    <header class="bg-white shadow-sm p-4 sticky top-0 z-50 w-full">
        <div class="flex flex-col md:flex-row justify-start items-center gap-6">
            <h1 class="text-xl font-bold text-blue-900 flex-shrink-0"><i class="fa-solid fa-chart-line mr-2"></i>การติดตามยอดขายรถมือสอง 2569</h1>
            
            <div class="flex items-center gap-2 text-sm bg-gray-50 p-2 rounded-lg border border-gray-200">
                <label for="monthFilter" class="font-semibold text-gray-700">เลือกเดือน:</label>
                <select id="monthFilter" class="border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <!-- Options generated by JS -->
                </select>
                <button onclick="loadData()" class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 transition shadow-sm">
                    <i class="fa-solid fa-sync-alt mr-1"></i> โหลด
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 p-4 flex gap-4 items-start" id="dashboard-container">
        <div class="flex items-center justify-center w-full h-64 text-gray-500">
            <p class="text-center"><i class="fa-solid fa-spinner fa-spin text-4xl mb-4"></i><br>กำลังโหลดข้อมูล...</p>
        </div>
    </main>

    <script>
        // ==========================================
        // ส่วนที่ 1: การตั้งค่า (Configuration)
        // ==========================================

        const csvLinks = {
            "มกราคม": "https://docs.google.com/spreadsheets/d/e/2PACX-1vTn_ZsMOs2Fus59OI79O2YYExpMwePQl935jKgJRmQ5OIaMNvNo9RfPAx7A-7NRLBE2sg4YXqYB5SXk/pub?gid=0&single=true&output=csv",
            "กุมภาพันธ์": "https://docs.google.com/spreadsheets/d/e/2PACX-1vTn_ZsMOs2Fus59OI79O2YYExpMwePQl935jKgJRmQ5OIaMNvNo9RfPAx7A-7NRLBE2sg4YXqYB5SXk/pub?gid=0&single=true&output=csv", 
            "มีนาคม": "https://docs.google.com/spreadsheets/d/e/2PACX-1vTn_ZsMOs2Fus59OI79O2YYExpMwePQl935jKgJRmQ5OIaMNvNo9RfPAx7A-7NRLBE2sg4YXqYB5SXk/pub?gid=0&single=true&output=csv",
            "เมษายน": "",
            "พฤษภาคม": "",
            "มิถุนายน": "",
            "กรกฎาคม": "",
            "สิงหาคม": "",
            "กันยายน": "",
            "ตุลาคม": "",
            "พฤศจิกายน": "",
            "ธันวาคม": ""
        };

        const branches = ["รวมทั้งหมด", "บ้านดู่", "พาน", "แม่สาย", "แม่จัน", "ลำพูน", "โอมาคาเสะ", "Car4U"];

        const financeStyles = {
            "WIN": { bg: "#b8b8b8", text: "#ff0000" },
            "TTB": { bg: "#4c7abd", text: "#ffff00" },
            "SCB": { bg: "#713896", text: "#ffc200" },
            "KLeasing": { bg: "#4ab958", text: "#ffffff" },
            "KKP": { bg: "#cec1d6", text: "#432856" },
            "NISSAN": { bg: "#f2f2f2", text: "#b71100" },
            "TIL": { bg: "#ff1800", text: "#afff00" },
            "Krungsri": { bg: "#ffb600", text: "#3d3a34" },
            "ซื้อสด": { bg: "#acd037", text: "#000000" },
            "Other": { bg: "#e5e7eb", text: "#374151" }
        };

        const statusList = [
            "รอไฟแนนซ์", "ผ่าน, รอปล่อย", "ผ่าน, ออกเดือนหน้า", "ส่งมอบแล้ว", 
            "เงินสด", "จอง/ยังไม่ได้ส่งไฟแนนซ์", "เงินสด, ออกเดือนหน้า", 
            "ปรับดาวน์", "ขอยกเลิกเคส", "ลููกค้าเตรียมเอกสาร", "เปลี่ยนชื่อผู้ซื้อ", 
            "เงินสด,รอปล่อย", "ลูกค้ายกเลิกเคส", "รีเจค"
        ];
        
        const sourceList = [
            "Walk in", "Call in", "เพจ Omakase", "เพจสงวนไทยมือสอง", 
            "เพจมือสองสาขา", "เพจส่วนตัว", "ลูกค้าเก่าแนะนำ", "โยกมาจากรถใหม่", 
            "อื่นๆ", "ลููกค้าเก่า", "CAR4U", "เพจลำพูน", "Tiktok"
        ];

        const sourceStyles = {
            "Walk in": { icon: "fa-person-walking", bg: "bg-stone-100", border: "border-stone-300", text: "text-stone-700" },
            "ลูกค้าเก่าแนะนำ": { icon: "fa-handshake", bg: "bg-amber-100", border: "border-amber-300", text: "text-amber-800" },
            "โยกมาจากรถใหม่": { icon: "fa-car-side", bg: "bg-stone-100", border: "border-stone-300", text: "text-stone-700" },
            "อื่นๆ": { icon: "fa-ellipsis", bg: "bg-gray-100", border: "border-gray-300", text: "text-gray-600" },
            "ลููกค้าเก่า": { icon: "fa-user-clock", bg: "bg-amber-100", border: "border-amber-300", text: "text-amber-800" },
            "Call in": { icon: "fa-phone-volume", bg: "bg-teal-100", border: "border-teal-300", text: "text-teal-800" },
            "เพจ Omakase": { icon: "fa-brands fa-facebook", bg: "bg-blue-100", border: "border-blue-300", text: "text-blue-800" },
            "เพจสงวนไทยมือสอง": { icon: "fa-brands fa-facebook", bg: "bg-blue-100", border: "border-blue-300", text: "text-blue-800" },
            "เพจมือสองสาขา": { icon: "fa-brands fa-facebook", bg: "bg-blue-100", border: "border-blue-300", text: "text-blue-800" },
            "เพจส่วนตัว": { icon: "fa-brands fa-facebook", bg: "bg-blue-100", border: "border-blue-300", text: "text-blue-800" },
            "เพจลำพูน": { icon: "fa-brands fa-facebook", bg: "bg-blue-100", border: "border-blue-300", text: "text-blue-800" },
            "CAR4U": { icon: "fa-globe", bg: "bg-sky-100", border: "border-sky-300", text: "text-sky-800" },
            "Tiktok": { icon: "fa-brands fa-tiktok", bg: "bg-pink-50", border: "border-pink-300", text: "text-pink-800" }
        };

        const monthAliases = {
            "มกราคม": ["มกราคม", "ม.ค.", "/01/", "/1/", "-01-", "-1-", "jan"],
            "กุมภาพันธ์": ["กุมภาพันธ์", "ก.พ.", "/02/", "/2/", "-02-", "-2-", "feb"],
            "มีนาคม": ["มีนาคม", "มี.ค.", "/03/", "/3/", "-03-", "-3-", "mar"],
            "เมษายน": ["เมษายน", "เม.ย.", "/04/", "/4/", "-04-", "-4-", "apr"],
            "พฤษภาคม": ["พฤษภาคม", "พ.ค.", "/05/", "/5/", "-05-", "-5-", "may"],
            "มิถุนายน": ["มิถุนายน", "มิ.ย.", "/06/", "/6/", "-06-", "-6-", "jun"],
            "กรกฎาคม": ["กรกฎาคม", "ก.ค.", "/07/", "/7/", "-07-", "-7-", "jul"],
            "สิงหาคม": ["สิงหาคม", "ส.ค.", "/08/", "/8/", "-08-", "-8-", "aug"],
            "กันยายน": ["กันยายน", "ก.ย.", "/09/", "/9/", "-09-", "-9-", "sep"],
            "ตุลาคม": ["ตุลาคม", "ต.ค.", "/10/", "-10-", "oct"],
            "พฤศจิกายน": ["พฤศจิกายน", "พ.ย.", "/11/", "-11-", "nov"],
            "ธันวาคม": ["ธันวาคม", "ธ.ค.", "/12/", "-12-", "dec"]
        };

        const monthFilter = document.getElementById('monthFilter');
        const container = document.getElementById('dashboard-container');

        function init() {
            monthFilter.innerHTML = '';
            for (const month in csvLinks) {
                const option = document.createElement('option');
                option.value = month;
                option.textContent = month;
                monthFilter.appendChild(option);
            }
            loadData();
        }

        function loadData() {
            const selectedMonth = monthFilter.value;
            const url = csvLinks[selectedMonth];

            if (!url) {
                container.innerHTML = `<div class="w-full text-center text-red-500 font-bold p-10">ยังไม่ได้ระบุลิงก์ CSV สำหรับเดือน ${selectedMonth}</div>`;
                return;
            }

            container.innerHTML = `<div class="w-full h-64 flex items-center justify-center text-gray-500"><p class="text-center"><i class="fa-solid fa-spinner fa-spin text-4xl mb-4"></i><br>กำลังดึงข้อมูล...</p></div>`;

            Papa.parse(url, {
                download: true,
                header: true,
                skipEmptyLines: true,
                transformHeader: function(h) { return h.trim(); },
                complete: function(results) {
                    processData(results.data, selectedMonth);
                },
                error: function(err) {
                    container.innerHTML = `<div class="text-red-500 font-bold p-10">เกิดข้อผิดพลาดในการโหลดไฟล์: ${err.message}</div>`;
                }
            });
        }

        function findColumnMap(dataRows) {
            if (!dataRows || dataRows.length === 0) return {};
            const keys = Object.keys(dataRows[0]);
            
            const mapping = {};
            const targets = {
                branch: ["สาขา"],
                bookingMonth: ["เดือนจอง", "เดือน"],
                bookingDate: ["วันจอง", "วันที่", "date"],
                finance: ["ไฟแนนซ์", "Finance"],
                status: ["สถานะ", "Status"],
                source: ["ที่มา", "Source"],
                brand: ["ยี่ห้อ", "Brand"],
                model: ["รุ่น", "Model"]
            };

            for (const [keyName, searchArr] of Object.entries(targets)) {
                const foundKey = keys.find(k => {
                    const cleanKey = k.replace(/\s+/g, '').toLowerCase();
                    return searchArr.some(s => cleanKey.includes(s.toLowerCase()));
                });
                mapping[keyName] = foundKey || null;
            }
            return mapping;
        }

        function isMonthMatch(text, monthName) {
            if (!text) return false;
            const aliases = monthAliases[monthName] || [monthName];
            const lowerText = text.toLowerCase();
            return aliases.some(alias => lowerText.includes(alias));
        }

        function processData(data, selectedMonth) {
            const colMap = findColumnMap(data);

            let branchData = {};
            branches.forEach(b => {
                branchData[b] = {
                    totalCases: 0,
                    currentCases: 0,
                    carriedOver: 0,
                    cashPurchase: 0,
                    finance: {},
                    status: {},
                    source: {},
                    brands: {},
                    models: []
                };
                Object.keys(financeStyles).forEach(f => branchData[b].finance[f] = { old: 0, current: 0, total: 0 });
                statusList.forEach(s => branchData[b].status[s] = 0);
                sourceList.forEach(s => branchData[b].source[s] = 0);
            });

            data.forEach(row => {
                const branchRaw = (colMap.branch ? row[colMap.branch] : "").trim();
                const bookingMonth = (colMap.bookingMonth ? row[colMap.bookingMonth] : "").trim();
                const bookingDate = (colMap.bookingDate ? row[colMap.bookingDate] : "").trim();
                const financeRaw = (colMap.finance ? row[colMap.finance] : "Other").trim();
                const statusRaw = (colMap.status ? row[colMap.status] : "").trim();
                const sourceRaw = (colMap.source ? row[colMap.source] : "อื่นๆ").trim();
                const brandRaw = (colMap.brand ? row[colMap.brand] : "").trim();
                const modelRaw = (colMap.model ? row[colMap.model] : "").trim();
                
                if (!branchRaw && !bookingMonth) return;

                let targetBranches = [];
                targetBranches.push("รวมทั้งหมด");

                if (branches.includes(branchRaw)) {
                    targetBranches.push(branchRaw);
                } else if (branches.some(b => branchRaw.includes(b))) {
                     const match = branches.find(b => branchRaw.includes(b));
                     if(match) targetBranches.push(match);
                }

                targetBranches.forEach(bKey => {
                    const stats = branchData[bKey];
                    if (!stats) return;

                    stats.totalCases++;
                    if (isMonthMatch(bookingMonth, selectedMonth)) {
                        stats.currentCases++;
                    } else if (bookingMonth !== "") {
                        stats.carriedOver++;
                    } else {
                         if (isMonthMatch(bookingDate, selectedMonth)) {
                             stats.currentCases++;
                         } else if (bookingDate !== "") {
                             stats.carriedOver++;
                         }
                    }

                    if (financeRaw.includes("สด") || financeRaw.includes("Cash")) {
                        stats.cashPurchase++;
                    }

                    let financeKey = "Other";
                    if (financeRaw.includes("WIN")) financeKey = "WIN";
                    else if (financeRaw.includes("TTB") || financeRaw.includes("ทหารไทย")) financeKey = "TTB";
                    else if (financeRaw.includes("SCB") || financeRaw.includes("ไทยพาณิชย์")) financeKey = "SCB";
                    else if (financeRaw.includes("KLeasing") || financeRaw.includes("กสิกร")) financeKey = "KLeasing";
                    else if (financeRaw.includes("KKP") || financeRaw.includes("เกียรตินาคิน")) financeKey = "KKP";
                    else if (financeRaw.includes("NISSAN") || financeRaw.includes("นิสสัน")) financeKey = "NISSAN";
                    else if (financeRaw.includes("TIL") || financeRaw.includes("ทิสโก้")) financeKey = "TIL"; 
                    else if (financeRaw.includes("Krungsri") || financeRaw.includes("กรุงศรี")) financeKey = "Krungsri";
                    else if (financeRaw.includes("สด") || financeRaw.includes("Cash")) financeKey = "ซื้อสด";

                    if (!stats.finance[financeKey]) stats.finance[financeKey] = { old: 0, current: 0, total: 0 };

                    let isCurrentMonthFinance = false;
                    if (isMonthMatch(bookingDate, selectedMonth)) {
                        isCurrentMonthFinance = true;
                    }

                    if (isCurrentMonthFinance) {
                        stats.finance[financeKey].current++;
                    } else {
                        stats.finance[financeKey].old++;
                    }
                    stats.finance[financeKey].total++;

                    let statusKey = statusList.find(s => statusRaw === s) || "อื่นๆ";
                    if (stats.status[statusRaw] !== undefined) {
                        stats.status[statusRaw]++;
                    } 

                    let matchedSource = sourceList.find(s => sourceRaw.includes(s));
                    if (matchedSource) {
                        stats.source[matchedSource]++;
                    } else if (sourceRaw === "" || sourceRaw === "-") {
                    } else {
                        if (stats.source["อื่นๆ"] !== undefined) stats.source["อื่นๆ"]++;
                    }

                    if (brandRaw) {
                        stats.brands[brandRaw] = (stats.brands[brandRaw] || 0) + 1;
                        stats.models.push({ brand: brandRaw, model: modelRaw });
                    }
                });
            });

            renderDashboard(branchData);
        }

        function renderDashboard(data) {
            container.innerHTML = '';

            branches.forEach(branch => {
                const bData = data[branch];
                
                const card = document.createElement('div');
                card.className = "card-width bg-white rounded-xl shadow-lg flex flex-col border-2 border-blue-800 flex-shrink-0 h-fit mb-4";
                
                card.innerHTML = `
                    <div class="bg-gradient-to-r from-blue-800 to-blue-600 text-white p-3 text-center rounded-t-lg sticky top-[75px] z-30 shadow-md">
                        <h2 class="text-xl font-bold">${branch}</h2>
                    </div>
                `;

                const content = document.createElement('div');
                content.className = "p-4 space-y-4";

                const part1 = `
                    <div class="grid grid-cols-2 gap-2 text-center">
                        <div class="bg-blue-100 p-2 rounded border-2 border-blue-600">
                            <div class="text-xs text-blue-800 font-semibold mb-1">เคสทั้งหมด</div>
                            <div class="text-big text-blue-800">${bData.totalCases}</div>
                        </div>
                        <div class="bg-orange-100 p-2 rounded border-2 border-orange-500">
                            <div class="text-xs text-orange-800 font-semibold mb-1">ยอดยกมา</div>
                            <div class="text-big text-orange-700">${bData.carriedOver}</div>
                        </div>
                        <div class="bg-purple-100 p-2 rounded border-2 border-purple-600">
                            <div class="text-xs text-purple-800 font-semibold mb-1">เคสปัจจุบัน</div>
                            <div class="text-big text-purple-800">${bData.currentCases}</div>
                        </div>
                        <div class="bg-green-100 p-2 rounded border-2 border-green-600">
                            <div class="text-xs text-green-800 font-semibold mb-1">ซื้อเงินสด</div>
                            <div class="text-big text-green-800">${bData.cashPurchase}</div>
                        </div>
                    </div>
                `;

                let part2HTML = `<div class="space-y-2 mt-4"><h3 class="font-bold text-gray-700 border-b pb-1 text-sm">ข้อมูลไฟแนนซ์</h3>`;
                
                Object.keys(financeStyles).forEach(fin => {
                    if (fin === "Other") return; 
                    const fData = bData.finance[fin] || { old: 0, current: 0, total: 0 };
                    const style = financeStyles[fin];
                    
                    part2HTML += `
                        <div class="flex items-center justify-between rounded px-2 py-1.5 shadow-sm" style="background-color: ${style.bg};">
                            <div class="font-bold text-xs w-20 truncate" style="color: ${style.text};">${fin}</div>
                            <div class="flex gap-1 text-center text-[10px]">
                                <div class="flex flex-col w-10 bg-white rounded p-0.5 shadow-sm">
                                    <span class="text-gray-400 text-[8px]">ยกมา</span>
                                    <span class="font-bold text-base leading-none text-red-600">${fData.old}</span>
                                </div>
                                <div class="flex flex-col w-10 bg-white rounded p-0.5 shadow-sm">
                                    <span class="text-gray-400 text-[8px]">ปัจจุบัน</span>
                                    <span class="font-bold text-base leading-none text-blue-500">${fData.current}</span>
                                </div>
                                <div class="flex flex-col w-10 bg-white rounded p-0.5 shadow-sm">
                                    <span class="text-gray-400 text-[8px]">รวม</span>
                                    <span class="font-bold text-base leading-none text-green-700">${fData.total}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });
                part2HTML += `</div>`;

                let part3StatusHTML = `<div class="mt-4"><h3 class="font-bold text-gray-700 border-b pb-1 mb-2 text-sm">สถานะเคส</h3><div class="grid grid-cols-2 gap-2">`;
                
                statusList.forEach(status => {
                    const count = bData.status[status] || 0;
                    let colorClass = "bg-gray-50 text-gray-700 border-gray-200";
                    let icon = "fa-circle-info";
                    
                    if(status.includes("ส่งมอบแล้ว") || status.includes("เงินสด")) { colorClass = "bg-green-100 text-green-800 border-green-200"; icon="fa-check-circle"; }
                    else if(status.includes("รอ")) { colorClass = "bg-yellow-50 text-yellow-800 border-yellow-200"; icon="fa-clock"; }
                    else if(status.includes("ยกเลิก") || status.includes("รีเจค")) { colorClass = "bg-red-50 text-red-800 border-red-200"; icon="fa-times-circle"; }
                    else if(status.includes("ผ่าน")) { colorClass = "bg-blue-50 text-blue-800 border-blue-200"; icon="fa-thumbs-up"; }

                    part3StatusHTML += `
                        <div class="flex items-center justify-between p-1.5 rounded border ${colorClass}">
                            <div class="flex items-center gap-1.5 overflow-hidden">
                                <i class="fa-solid ${icon} text-[10px] opacity-70"></i>
                                <span class="text-[10px] truncate leading-tight" title="${status}">${status}</span>
                            </div>
                            <span class="font-bold text-base">${count}</span>
                        </div>
                    `;
                });
                part3StatusHTML += `</div></div>`;

                let part3SourceHTML = `<div class="mt-4"><h3 class="font-bold text-gray-700 border-b pb-1 mb-2 text-sm">ที่มาลูกค้า</h3><div class="grid grid-cols-2 gap-2">`;
                
                sourceList.forEach(source => {
                    const count = bData.source[source] || 0;
                    const style = sourceStyles[source] || { icon: "fa-circle-question", bg: "bg-gray-50", border: "border-gray-200", text: "text-gray-700" };
                    
                    part3SourceHTML += `
                        <div class="flex items-center justify-between p-1.5 rounded border ${style.bg} ${style.border} ${style.text}">
                             <div class="flex items-center gap-1.5 overflow-hidden">
                                <i class="fa-solid ${style.icon} text-[10px] opacity-70"></i>
                                <span class="text-[10px] truncate leading-tight" title="${source}">${source}</span>
                            </div>
                            <span class="font-bold text-base">${count}</span>
                        </div>
                    `;
                });
                part3SourceHTML += `</div></div>`;

                let part4HTML = `<div class="mt-4"><h3 class="font-bold text-gray-700 border-b pb-1 mb-2 text-sm">ยี่ห้อรถ</h3>`;
                part4HTML += `<div class="flex flex-wrap gap-2 mb-3">`;
                if(Object.keys(bData.brands).length === 0) part4HTML += `<span class="text-gray-400 text-xs italic">ไม่มีข้อมูล</span>`;
                
                for(const [brand, count] of Object.entries(bData.brands)) {
                    part4HTML += `
                        <div class="flex flex-col items-center bg-gray-800 text-white rounded p-1.5 min-w-[50px]">
                            <span class="text-[9px] uppercase tracking-wider">${brand}</span>
                            <span class="text-lg font-bold leading-tight">${count}</span>
                        </div>
                    `;
                }
                part4HTML += `</div>`;

                // Aggregate and Sort Models
                const modelCounts = bData.models.reduce((acc, curr) => {
                    const key = `${curr.brand}|${curr.model}`;
                    if (!acc[key]) {
                        acc[key] = { brand: curr.brand, model: curr.model, count: 0 };
                    }
                    acc[key].count++;
                    return acc;
                }, {});

                const sortedModels = Object.values(modelCounts).sort((a, b) => b.count - a.count);

                part4HTML += `
                    <div class="overflow-x-auto border rounded-lg">
                        <table class="min-w-full text-xs text-left">
                            <thead class="bg-gray-100 font-bold text-gray-600 uppercase">
                                <tr>
                                    <th class="px-2 py-1.5 whitespace-nowrap">ยี่ห้อ</th>
                                    <th class="px-2 py-1.5 w-full">รุ่น</th>
                                    <th class="px-2 py-1.5 text-center whitespace-nowrap">จำนวน</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100">
                `;
                if(sortedModels.length === 0) {
                     part4HTML += `<tr><td colspan="3" class="px-3 py-2 text-center text-gray-400">ไม่มีข้อมูล</td></tr>`;
                } else {
                    sortedModels.forEach(item => {
                        part4HTML += `
                            <tr>
                                <td class="px-2 py-1.5 font-semibold whitespace-nowrap text-[10px]">${item.brand}</td>
                                <td class="px-2 py-1.5 text-gray-600 text-[10px]">${item.model || "-"}</td>
                                <td class="px-2 py-1.5 text-center font-bold text-blue-600 text-[10px] bg-blue-50">${item.count}</td>
                            </tr>
                        `;
                    });
                }
                part4HTML += `</tbody></table></div></div>`;

                content.innerHTML = part1 + part2HTML + part3StatusHTML + part3SourceHTML + part4HTML;
                card.appendChild(content);
                
                container.appendChild(card);
            });
        }

        init();

    </script>
</body>
</html>
